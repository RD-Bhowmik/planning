{% extends "base.html" %} {% block title %}Daily Income Tracker{% endblock %} {%
block content %}

<header class="mb-4">
  <div class="mb-3">
    <h1 class="display-4 mb-2">
      <i class="bi bi-calendar-day text-primary"></i> Daily Income Tracker
    </h1>
    <p class="lead text-muted mb-0">
      Log your daily work hours and income. Track earnings after tax deduction.
    </p>
  </div>
</header>

<!-- Summary Cards -->
<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div
      class="card border-0 shadow-sm"
      style="
        background: linear-gradient(
          135deg,
          rgba(11, 163, 96, 0.1) 0%,
          rgba(60, 186, 146, 0.1) 100%
        );
        border-left: 4px solid #0ba360;
      "
    >
      <div class="card-body text-center p-3">
        <div class="mb-2">
          <div
            class="p-2 rounded-circle d-inline-block"
            style="
              background: linear-gradient(135deg, #0ba360 0%, #3cba92 100%);
            "
          >
            <i class="bi bi-cash-coin fs-4 text-white"></i>
          </div>
        </div>
        <h6 class="text-muted mb-2 fw-semibold">Total Net Income</h6>
        <p class="h3 mb-1 fw-bold text-success">
          {{ "%.2f"|format(total_net_daily_income) }}
        </p>
        <p class="text-muted small mb-1">AUD</p>
        <small class="text-muted fst-italic" style="font-size: 0.75rem">
          <i class="bi bi-info-circle"></i> After {{ settings.tax_rate_percent
          }}% tax
        </small>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div
      class="card border-0 shadow-sm"
      style="
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.1) 0%,
          rgba(118, 75, 162, 0.1) 100%
        );
        border-left: 4px solid #667eea;
      "
    >
      <div class="card-body text-center p-3">
        <div class="mb-2">
          <i class="bi bi-calendar-check fs-4" style="color: #667eea"></i>
        </div>
        <h6 class="text-muted mb-2 fw-semibold">Total Days Worked</h6>
        <p class="h3 mb-1 fw-bold" style="color: #667eea">
          {{ daily_income_tracker|length }}
        </p>
        <p class="text-muted small mb-0">days</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div
      class="card border-0 shadow-sm"
      style="
        background: linear-gradient(
          135deg,
          rgba(240, 147, 251, 0.1) 0%,
          rgba(245, 87, 108, 0.1) 100%
        );
        border-left: 4px solid #f093fb;
      "
    >
      <div class="card-body text-center p-3">
        <div class="mb-2">
          <i class="bi bi-clock-history fs-4" style="color: #f093fb"></i>
        </div>
        <h6 class="text-muted mb-2 fw-semibold">Total Hours</h6>
        <p class="h3 mb-1 fw-bold" style="color: #f093fb">
          {{ "%.1f"|format(daily_income_tracker|sum(attribute='hours_worked'))
          }}
        </p>
        <p class="text-muted small mb-0">hours</p>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="row g-4">
  <!-- Income Log Table (Wider) -->
  <div class="col-lg-8">
    <div class="card shadow-lg border-0">
      <div
        class="card-header text-white py-3"
        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
      >
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0">
            <i class="bi bi-journal-text"></i> Income Log
            <span class="badge bg-white text-primary ms-2"
              >{{ daily_income_tracker|length }} entries</span
            >
          </h4>
          <form
            action="{{ url_for('update_sort_order') }}"
            method="post"
            class="d-inline"
          >
            <div class="btn-group btn-group-sm" role="group">
              <input type="radio" class="btn-check" name="sort_order"
              id="daily_newest_first" value="newest_first" {% if
              settings.get('table_sort_order', 'newest_first') == 'newest_first'
              %}checked{% endif %} onchange="this.form.submit()">
              <label class="btn btn-outline-light" for="daily_newest_first">
                <i class="bi bi-arrow-down-circle"></i> Newest First
              </label>

              <input type="radio" class="btn-check" name="sort_order"
              id="daily_oldest_first" value="oldest_first" {% if
              settings.get('table_sort_order') == 'oldest_first' %}checked{%
              endif %} onchange="this.form.submit()">
              <label class="btn btn-outline-light" for="daily_oldest_first">
                <i class="bi bi-arrow-up-circle"></i> Oldest First
              </label>
            </div>
          </form>
        </div>
      </div>
      <div class="card-body p-0">
        <div
          class="table-responsive"
          style="max-height: 600px; overflow-y: auto"
        >
          <table class="table table-hover mb-0">
            <thead
              class="sticky-top"
              style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
              "
            >
              <tr>
                <th class="py-3 px-4"><i class="bi bi-calendar3"></i> Date</th>
                <th class="py-3 px-4 text-center">
                  <i class="bi bi-clock"></i> Hours
                </th>
                <th class="py-3 px-4 text-end">
                  <i class="bi bi-cash"></i> Gross Income
                </th>
                <th class="py-3 px-4 text-end">
                  <i class="bi bi-wallet2"></i> Net Income
                </th>
                <th class="py-3 px-4 text-center">
                  <i class="bi bi-gear"></i> Actions
                </th>
              </tr>
            </thead>
            <tbody>
              {% set sorted_entries = daily_income_tracker|reverse if
              settings.get('table_sort_order', 'newest_first') == 'newest_first'
              else daily_income_tracker %} {% for entry in sorted_entries %}
              <tr>
                <td class="py-3 px-4 fw-semibold">
                  {{ datetime.strptime(entry.date, '%Y-%m-%d').strftime('%B %d,
                  %Y') }}
                </td>
                <td class="py-3 px-4 text-center">
                  <span class="badge bg-info">{{ entry.hours_worked }}h</span>
                </td>
                <td class="py-3 px-4 text-end text-muted">
                  {{ "%.2f"|format(entry.gross_income) }} AUD
                </td>
                <td class="py-3 px-4 text-end fw-bold text-success">
                  {{ "%.2f"|format(calculate_net_income(entry.gross_income,
                  settings.tax_rate_percent)) }} AUD
                </td>
                <td class="py-3 px-4 text-center">
                  <div class="btn-group btn-group-sm">
                    <a
                      href="{{ url_for('edit_daily_entry', index=loop.index0) }}"
                      class="btn btn-outline-primary"
                      title="Edit"
                    >
                      <i class="bi bi-pencil"></i>
                    </a>
                    <a
                      href="{{ url_for('delete_item', list_name='daily_income_tracker', index=loop.index0) }}"
                      class="btn btn-outline-danger"
                      title="Delete"
                      onclick="return confirm('Delete this entry?');"
                    >
                      <i class="bi bi-trash"></i>
                    </a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
            <tfoot class="sticky-bottom" style="background: #f8f9fa">
              <tr class="fw-bold">
                <td class="py-3 px-4">Totals</td>
                <td class="py-3 px-4 text-center">
                  {{
                  "%.1f"|format(daily_income_tracker|sum(attribute='hours_worked'))
                  }}h
                </td>
                <td class="py-3 px-4 text-end">
                  {{
                  "%.2f"|format(daily_income_tracker|sum(attribute='gross_income'))
                  }} AUD
                </td>
                <td class="py-3 px-4 text-end text-success">
                  {{ "%.2f"|format(total_net_daily_income) }} AUD
                </td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>
        {% if not daily_income_tracker %}
        <div class="p-5 text-center">
          <i class="bi bi-inbox fs-1 text-muted mb-3"></i>
          <p class="text-muted">
            No entries yet. Add your first daily income entry using the form on
            the right.
          </p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Sidebar - Forms -->
  <div class="col-lg-4">
    <div class="sticky-top" style="top: 100px">
      <!-- Add Daily Entry Form -->
      <div
        class="card shadow-lg mb-4 border-0"
        style="border-left: 5px solid #0ba360"
      >
        <div
          class="card-header text-white py-3"
          style="background: linear-gradient(135deg, #0ba360 0%, #3cba92 100%)"
        >
          <h5 class="mb-0">
            <i class="bi bi-plus-circle-fill"></i> Add Daily Entry
          </h5>
        </div>
        <div class="card-body p-4">
          <form action="{{ url_for('add_daily_entry') }}" method="post">
            <div class="mb-3">
              <label for="date" class="form-label fw-semibold">
                <i class="bi bi-calendar3"></i> Date
              </label>
              <input
                type="date"
                class="form-control form-control-lg"
                id="date"
                name="date"
                value="{{ datetime.now().strftime('%Y-%m-%d') }}"
                required
              />
            </div>
            <div class="mb-3">
              <label for="hours_worked" class="form-label fw-semibold">
                <i class="bi bi-clock"></i> Hours Worked
              </label>
              <div class="input-group input-group-lg">
                <input
                  type="number"
                  step="0.1"
                  class="form-control"
                  id="hours_worked"
                  name="hours_worked"
                  placeholder="8.0"
                  required
                />
                <span class="input-group-text">hours</span>
              </div>
            </div>
            <div class="mb-3">
              <label for="gross_income" class="form-label fw-semibold">
                <i class="bi bi-cash-stack"></i> Gross Income
              </label>
              <div class="input-group input-group-lg">
                <span class="input-group-text">AUD</span>
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="gross_income"
                  name="gross_income"
                  placeholder="0.00"
                  required
                />
              </div>
            </div>
            <button type="submit" class="btn btn-success w-100 py-2 shadow">
              <i class="bi bi-check-circle"></i> Add Entry
            </button>
          </form>
        </div>
      </div>

      <!-- Tax Rate Settings -->
      <div
        class="card shadow-lg border-0"
        style="border-left: 5px solid #667eea"
      >
        <div
          class="card-header text-white py-3"
          style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
        >
          <h5 class="mb-0"><i class="bi bi-sliders"></i> Tax Settings</h5>
        </div>
        <div class="card-body p-4">
          <form action="{{ url_for('update_tax_rate') }}" method="post">
            <div class="mb-3">
              <label for="tax_rate" class="form-label fw-semibold">
                <i class="bi bi-percent"></i> Tax Rate
              </label>
              <div class="input-group input-group-lg">
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="tax_rate"
                  name="tax_rate"
                  value="{{ settings.tax_rate_percent }}"
                  required
                />
                <span class="input-group-text">%</span>
              </div>
              <div class="form-text">
                <i class="bi bi-info-circle"></i> Applied to all income
                calculations
              </div>
            </div>
            <button type="submit" class="btn btn-primary w-100 py-2 shadow">
              <i class="bi bi-save"></i> Update Tax Rate
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .table thead.sticky-top th {
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .table tfoot.sticky-bottom td {
    position: sticky;
    bottom: 0;
    z-index: 10;
  }

  .table-responsive::-webkit-scrollbar {
    width: 8px;
  }

  .table-responsive::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }

  .table-responsive::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 4px;
  }

  .table tbody tr {
    transition: all 0.2s ease;
  }

  .table tbody tr:hover {
    background-color: rgba(102, 126, 234, 0.08);
    transform: scale(1.01);
  }

  /* Mobile Optimizations for Daily Tracker Page */
  @media (max-width: 768px) {
    /* Summary cards - better stacking */
    .col-md-4 {
      padding: 0.25rem !important;
    }

    /* Main layout - full width */
    .col-lg-8,
    .col-lg-4 {
      width: 100%;
      max-width: 100%;
    }

    /* Table - scrollable */
    .table-responsive {
      max-height: 400px !important;
    }

    /* Card header with sort buttons */
    .card-header .d-flex {
      flex-direction: column;
      gap: 0.5rem;
      align-items: flex-start !important;
    }

    .card-header h4 {
      font-size: 1rem !important;
      width: 100%;
    }

    .card-header .btn-group {
      width: 100%;
      display: flex;
    }

    .card-header .btn-group label {
      flex: 1;
      font-size: 0.75rem;
      padding: 0.4rem 0.5rem;
    }

    /* Remove sticky on mobile */
    .sticky-top {
      position: relative !important;
      top: 0 !important;
    }
  }

  @media (max-width: 576px) {
    /* Header adjustments */
    header .display-4 {
      font-size: 1.5rem !important;
    }

    /* Summary cards - compact */
    .card-body {
      padding: 0.75rem !important;
    }

    .card-body .fs-4 {
      font-size: 1.25rem !important;
    }

    .card-body h6 {
      font-size: 0.85rem !important;
    }

    .card-body .h3 {
      font-size: 1.25rem !important;
    }

    /* Table - more compact */
    .table {
      font-size: 0.75rem !important;
    }

    .table thead th,
    .table tbody td,
    .table tfoot td {
      padding: 0.5rem 0.35rem !important;
      font-size: 0.75rem;
    }

    /* Disable hover transform on mobile */
    .table tbody tr:hover {
      transform: none;
    }

    /* Action buttons - smaller */
    .btn-group-sm .btn {
      padding: 0.25rem 0.35rem;
      font-size: 0.7rem;
    }

    /* Badge sizing */
    .badge {
      font-size: 0.7rem;
      padding: 0.3rem 0.5rem;
    }

    /* Form optimization */
    .form-control-lg,
    .input-group-lg .form-control {
      font-size: 0.9rem !important;
      padding: 0.55rem 0.7rem !important;
    }

    .input-group-lg .input-group-text {
      font-size: 0.9rem !important;
      padding: 0.55rem 0.7rem !important;
    }

    .form-label {
      font-size: 0.85rem !important;
      margin-bottom: 0.4rem;
    }

    .form-text {
      font-size: 0.75rem !important;
    }

    /* Card spacing */
    .card.mb-4 {
      margin-bottom: 1rem !important;
    }

    /* Date format - shorter on mobile */
    .table tbody td:first-child {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100px;
    }
  }

  /* Very small phones */
  @media (max-width: 375px) {
    /* Ultra compact table */
    .table {
      font-size: 0.7rem !important;
    }

    .table thead th,
    .table tbody td,
    .table tfoot td {
      padding: 0.4rem 0.25rem !important;
    }

    /* Hide some table icons to save space */
    .table th i {
      display: none;
    }

    /* Forms - minimal padding */
    .card-body {
      padding: 0.65rem !important;
    }

    /* Buttons - smaller */
    .btn {
      font-size: 0.8rem;
      padding: 0.4rem 0.7rem;
    }

    /* Date input - full width */
    input[type="date"] {
      font-size: 0.85rem !important;
    }
  }

  /* Landscape optimization */
  @media (max-width: 768px) and (orientation: landscape) {
    .table-responsive {
      max-height: 300px !important;
    }

    .card {
      margin-bottom: 0.5rem !important;
    }

    /* Summary cards in a row */
    .row.g-3 {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
    }

    .row.g-3 > .col-md-4 {
      flex: 0 0 auto;
      width: 50%;
    }
  }
</style>

{% endblock %}
